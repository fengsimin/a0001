<?php
//Copyright (c) 2016 iFeiwu.com
 class Finder extends Ifeiwu { private $root = "\144\141\164\x61\57\x66\x69\x6e\144\x65\x72\x2f"; function __construct() { goto uAors; IeySm: NmtaC: goto CjMRq; CjMRq: parent::__construct(); goto FshOR; uAors: if ($this->table) { goto NmtaC; } goto COL8i; COL8i: $this->table = "\146\x69\x6e\x64\145\162"; goto IeySm; FshOR: } protected function postAll($pid, $request_data) { goto vEaEg; gl7wS: $paths = $this->db->select($this->table, array("\x69\144", "\156\141\155\x65"))->where(array("\151\144", "\111\116", $level), "\101\x4e\104", array("\164\171\x70\145", "\x3d", "\146\157\154\144\x65\162"))->all(); goto eiqmj; N9z0d: $level = array_filter(explode("\x2c", $level)); goto gl7wS; j6qXS: $paths = array(); goto vL2FM; vL2FM: if (!$pid) { goto Ysjp8; } goto jkAJ1; eiqmj: Ysjp8: goto WkDx6; vEaEg: $files = $this->db->select($this->table)->where($request_data["\167\x68\x65\162\145"])->order($request_data["\157\162\x64\x65\x72"])->all(); goto j6qXS; WkDx6: return array("\x66\151\154\145\163" => $files, "\160\x61\x74\x68\x73" => $paths); goto KPSgg; jkAJ1: $level = $this->db->select($this->table, "\154\145\x76\145\154")->where(array("\x69\144", "\x3d", $pid))->get(0); goto N9z0d; KPSgg: } protected function postAdd($request_data) { goto tPu7_; MTPo2: return $this->error("\xe4\xb8\x8a\344\xbc\xa0\346\x96\207\xe4\xbb\xb6\40" . $name . "\40\345\244\xb1\350\264\245\xef\274\201"); goto of0eK; BoflT: $foid = $request_data["\146\157\151\x64"]; goto rYroc; Vnwdi: if (mkdir($this->_UTF82GBK("\x2e\56\x2f" . $path), 511, true)) { goto Jd_j6; } goto uy5Rb; J_ggH: Jd_j6: goto sDJqO; YyvGx: $this->db->beginTransaction(); goto WYYDx; RbJHw: L296E: goto Cc0Pq; O6thC: return $this->success(); goto RbJHw; aECRt: $data["\x73\x69\x7a\145"] = $request_data["\163\x69\x7a\145"]; goto lCSoF; eksxa: $data["\x65\x78\x74"] = end(explode("\56", $name)); goto YyvGx; Yq1fW: $data["\x77\151\x64\x74\x68"] = $imagesize[0]; goto G482Q; HUBde: $imagesize = getimagesize($filename); goto Yq1fW; PWx6S: $data["\x6e\x61\155\145"] = $name; goto fhToI; EPIjS: unlink($filename); goto Q8NCL; mK6Fx: $name = $request_data["\x6e\x61\155\145"]; goto X3I1j; Q8NCL: $this->db->rollBack(); goto MTPo2; rYroc: if (is_dir($this->_UTF82GBK("\x2e\56\x2f" . $path))) { goto XSz3K; } goto Vnwdi; Cc0Pq: $this->db->rollBack(); goto SElTH; lCSoF: $data["\143\x74\x69\x6d\x65"] = time(); goto eksxa; fdUn7: $filename = $this->_UTF82GBK("\56\x2e\x2f" . $path . $name); goto Aelz3; of0eK: SBkN_: goto ru2ZL; F2iem: $data["\160\x61\164\x68"] = $path; goto PWx6S; WYYDx: if ($id = $this->db->insert($this->table, $data)->id()) { goto SBkN_; } goto EPIjS; Aelz3: if (!(stripos($type, "\x69\x6d\141\147\x65") !== false && is_file($filename))) { goto ah2pB; } goto HUBde; X3I1j: $type = mime_content_type("\x2e\x2e\x2f" . $path . $name); goto BoflT; sDJqO: XSz3K: goto fdUn7; ZYHeS: $this->db->commit(); goto O6thC; tPu7_: $path = $request_data["\160\x61\164\150"]; goto mK6Fx; SElTH: return $this->error("\xe4\xb8\212\xe4\xbc\240\xe6\226\x87\344\xbb\xb6\x20" . $name . "\40\345\xa4\xb1\xe8\264\xa5\xef\274\201"); goto xOFyo; KHisX: ah2pB: goto F2iem; are3a: $data["\160\x69\144"] = $foid ? $foid : 0; goto aECRt; uy5Rb: return $this->error("\345\210\x9b\345\273\xba\346\226\x87\xe4\273\xb6\345\xa4\xb9\xe5\xa4\261\350\xb4\xa5\xef\274\201"); goto J_ggH; ru2ZL: $level = $this->_getLevel($id); goto zF98I; zF98I: if (!$this->db->update($this->table, array("\x6c\145\x76\145\x6c" => $level), array("\x69\x64", "\75", $id))->is()) { goto L296E; } goto ZYHeS; fhToI: $data["\164\171\x70\145"] = $type; goto are3a; G482Q: $data["\x68\x65\x69\x67\150\164"] = $imagesize[1]; goto KHisX; xOFyo: } protected function postMkdir($request_data) { goto U0_Er; S81qj: goto Qvh1v; goto sEEt9; FmQdg: return $this->error("\345\210\233\xe5\273\272\346\x96\207\xe4\xbb\xb6\xe5\244\271\345\244\xb1\350\264\xa5\xef\274\x81"); goto eX_JA; NMZy2: return $this->error("\xe6\227\xa0\346\x95\x88\347\x9a\204\xe5\217\x82\346\x95\xb0\357\274\201"); goto OlgOF; xS0CD: $data["\160\151\144"] = $pid; goto MDWcz; S0n9O: if (!is_dir($dirname)) { goto pIaoj; } goto lUaUk; ZMB4H: uyGEX: goto GwilF; sEEt9: YhbAU: goto wHq6M; ZN8A7: return $this->success(); goto IeJ7L; EFzwc: pIaoj: goto wixx3; CkImD: a5Vl5: goto PnPRT; Bhjhr: $level = array_filter(explode("\54", $level)); goto UDvvA; aUhcP: $level = $this->db->select($this->table, "\x60\x6c\145\166\x65\x6c\140")->where(array("\151\x64", "\75", $pid))->get(0); goto eyWrQ; AKNtL: return $this->error("\345\210\233\345\xbb\xba\xe6\x96\x87\344\273\266\345\244\xb9\xe5\244\xb1\xe8\xb4\xa5\xef\xbc\201"); goto ZMB4H; tkCvU: $data["\143\x74\151\x6d\145"] = time(); goto sG7Cc; sKX_O: $data = array(); goto JCTED; HSQps: $this->db->rollBack(); goto LQuAS; F4JAH: if (!($name === null || $name === '')) { goto sVS60; } goto NMZy2; eyWrQ: if (!$level) { goto a5Vl5; } goto Bhjhr; MDWcz: $folder_path = ''; goto aUhcP; Ik8xE: $data["\163\x6f\x72\x74\x62\x79"] = 1; goto Yrwr0; sG7Cc: if ($id = $this->db->insert($this->table, $data)->id()) { goto MGLVT; } goto YWcy1; OlgOF: sVS60: goto sKX_O; YWcy1: rmdir($dirname); goto c0QZ8; Dh_e8: foreach ($folder as $value) { $folder_path .= $value["\156\x61\155\145"] . "\x2f"; Qr3pi: } goto EZgYo; eX_JA: MGLVT: goto wrvXK; GwilF: $this->db->beginTransaction(); goto P3Ppi; wHq6M: $this->db->commit(); goto ZN8A7; JCTED: $data["\156\141\x6d\x65"] = $name; goto xS0CD; UDvvA: $folder = $this->db->select($this->table, "\x60\156\x61\x6d\145\x60")->where(array("\x69\144", "\111\116", $level), "\x41\x4e\x44", array("\164\x79\160\x65", "\75", "\146\x6f\154\144\145\x72"))->all(); goto Dh_e8; c0QZ8: $this->db->rollBack(); goto FmQdg; P3Ppi: $data["\160\x61\164\150"] = $this->root . $folder_path; goto Ik8xE; Yrwr0: $data["\x74\x79\160\145"] = "\146\x6f\154\x64\145\162"; goto tkCvU; wixx3: if (mkdir($dirname, 493, true)) { goto uyGEX; } goto AKNtL; U0_Er: $pid = $request_data["\x70\x69\144"]; goto HH252; EZgYo: Sf4u2: goto CkImD; wrvXK: $level = $this->_getLevel($id); goto ynW40; HH252: $name = $request_data["\x6e\141\155\x65"]; goto F4JAH; FkgJy: rmdir($dirname); goto HSQps; IeJ7L: Qvh1v: goto AcMPR; LQuAS: return $this->error("\345\x88\x9b\345\273\272\xe6\226\x87\344\xbb\266\345\xa4\271\xe5\244\xb1\xe8\xb4\xa5\xef\274\201"); goto S81qj; ynW40: if ($this->db->update($this->table, array("\154\x65\x76\145\x6c" => $level), array("\151\x64", "\75", $id))->is()) { goto YhbAU; } goto FkgJy; PnPRT: $dirname = $this->_UTF82GBK("\x2e\x2e\57" . $this->root . $folder_path . $name); goto S0n9O; lUaUk: return $this->error($name . "\40\346\x96\207\344\xbb\xb6\xe5\xa4\271\xe5\xb7\262\345\xad\230\345\x9c\xa8\xef\274\201"); goto EFzwc; AcMPR: } protected function postRename($request_data) { goto sC28p; brrEd: goto eTfur; goto vPJAk; UOWmL: return $this->error("\346\211\276\xe4\xb8\x8d\345\210\xb0\xe9\207\x8d\xe5\x91\275\xe5\220\x8d\347\232\x84\xe6\226\207\344\xbb\xb6\57\xe6\226\207\xe4\xbb\xb6\345\244\271\xef\274\x81"); goto MGpuj; lNTzp: EmNcd: goto Hn1Ev; w7hKu: S34IO: goto yYPFW; ZjFer: vSKYP: goto MCJiP; mpQ7F: return $this->success(); goto ph1lG; zwBI1: return $this->success(); goto lNTzp; ph1lG: Q7Yj3: goto vywqV; wjbLn: $this->db->rollBack(); goto gKxGW; vPJAk: FZHHj: goto ljhVx; gD_jv: ncpB3: goto FpRz8; IfQtu: if (is_dir($oldname)) { goto FZHHj; } goto UOWmL; vBhAC: return $this->error("\xe6\x96\x87\344\273\xb6\xe9\x87\215\xe5\221\275\xe5\220\215\345\244\xb1\350\xb4\245\xef\xbc\201"); goto WqAEy; eRCa7: goto EmNcd; goto bDk91; gKxGW: return $this->error("\346\226\207\xe4\xbb\xb6\xe9\x87\x8d\345\x91\xbd\345\x90\215\345\244\261\xe8\xb4\245\xef\274\201"); goto RIlox; bMOcD: if (!(!$path || stripos($path, $this->root) === false)) { goto hm_2G; } goto WorcV; MnW5C: $finder = $this->db->select($this->table, array("\x70\141\164\150", "\156\141\155\145", "\x6c\x65\x76\x65\154"))->where(array("\x69\144", "\x3d", $id))->get(); goto T3fch; i2gmE: eTfur: goto vAr5p; rZGIh: if (rename($oldname, $newname)) { goto S34IO; } goto hHCok; RIlox: goto d0vvd; goto haEs2; xqmpF: MrUdd: goto i2gmE; E6_H2: return $this->error("\xe6\227\xa0\346\x95\210\347\232\204\xe5\x8f\202\346\x95\260\357\xbc\201"); goto POfGb; fTprQ: $this->db->rollBack(); goto cWeSd; fNrbL: $name = $request_data["\156\141\x6d\x65"]; goto r7aYV; aZmT5: $oldname = $this->_UTF82GBK("\x2e\x2e\57" . $path . $finder["\156\141\x6d\x65"]); goto thxYR; YzTsx: hm_2G: goto aZmT5; r7aYV: if (!(!$id || $name === null || $name === '')) { goto D4tLe; } goto E6_H2; IuzRd: if (is_file($oldname)) { goto ncpB3; } goto IfQtu; dSav2: $this->db->beginTransaction(); goto IuzRd; w3Hx5: return $this->error("\346\x96\207\344\xbb\266\xe5\xa4\xb9\351\x87\x8d\xe5\221\275\345\x90\x8d\xe5\244\xb1\xe8\xb4\245\xef\xbc\x81"); goto KlW54; KlW54: goto MrUdd; goto klrGS; hHCok: $this->db->rollBack(); goto vBhAC; POfGb: D4tLe: goto MnW5C; cWeSd: return $this->error($name . "\40\346\x96\x87\344\273\266\345\xa4\271\xe5\267\xb2\345\255\230\345\x9c\xa8\357\xbc\201"); goto gr6xc; mDPdd: if (rename($oldname, $newname)) { goto vSKYP; } goto fTprQ; P5bBN: rename($newname, $oldname); goto FctAu; haEs2: J2Mzn: goto rZGIh; XJhh8: $this->db->rollBack(); goto w3Hx5; WqAEy: goto Q7Yj3; goto w7hKu; WorcV: return $this->error("\xe6\227\240\xe6\225\x88\347\x9a\x84\350\xb7\257\xe5\xbe\x84\357\xbc\201"); goto YzTsx; NyyF8: if ($is_path_update !== false) { goto g_vAE; } goto P5bBN; CKwd0: return $this->error("\xe6\226\x87\344\xbb\xb6\345\244\xb9\xe9\x87\x8d\xe5\x91\xbd\xe5\220\215\xe5\xa4\261\350\xb4\245\357\xbc\x81"); goto eRCa7; sC28p: $id = $request_data["\151\144"]; goto fNrbL; thxYR: $newname = $this->_UTF82GBK("\56\56\57" . $path . $name); goto dSav2; yDPX2: foreach ($sublist as $sub) { goto PjFFG; vXF8T: $level = array_filter(explode("\x2c", $sub["\x6c\x65\166\145\154"])); goto hRdQN; WEDIR: if (!($is_path_update === false)) { goto FYcdN; } goto bMswx; hRdQN: foreach ($level as $lid) { goto vqkvo; xcvE_: e43cd: goto rTt3f; C2e3T: if (!($sub["\x74\x79\x70\x65"] == "\146\157\x6c\144\x65\x72" && $sub["\154\x65\166\x65\154"] == $levelobj["\x6c\x65\x76\x65\154"])) { goto HwLAY; } goto tCA0Q; vqkvo: $levelobj = $this->db->select($this->table, array("\x6e\141\155\145", "\154\x65\166\145\x6c"))->where("\x69\144\40\75\40{$lid}\x20\x41\x4e\x44\40\164\x79\x70\145\x20\75\x20\47\146\x6f\154\x64\145\x72\x27")->get(); goto C2e3T; AFfFs: HwLAY: goto OIzmd; umK_C: $newpath .= $level_name != '' ? $level_name . "\x2f" : ''; goto xcvE_; OIzmd: $level_name = $levelobj["\156\141\155\145"]; goto umK_C; tCA0Q: goto e43cd; goto AFfFs; rTt3f: } goto xBihj; xtC10: $is_path_update = $this->db->update($this->table, array("\x70\141\164\150" => $this->root . $newpath), array("\151\144", "\75", $sub["\151\144"]))->is(); goto WEDIR; n7Xj6: $newpath = ''; goto vXF8T; lyGHH: FYcdN: goto EmDRe; PjFFG: if (!($sub["\154\x65\166\145\154"] == $finder["\x6c\145\x76\x65\x6c"])) { goto ne3bb; } goto nAwxo; xBihj: jg3tb: goto xtC10; EmDRe: G5xwO: goto ao52B; bMswx: goto F42qX; goto lyGHH; nAwxo: goto G5xwO; goto WmNzg; WmNzg: ne3bb: goto n7Xj6; ao52B: } goto rT5Yn; vywqV: d0vvd: goto brrEd; MGpuj: goto eTfur; goto gD_jv; T3fch: $path = $finder["\160\x61\x74\x68"]; goto bMOcD; yYPFW: $this->db->commit(); goto mpQ7F; rT5Yn: F42qX: goto NyyF8; MCJiP: $sublist = $this->db->select($this->table, array("\151\x64", "\x6c\145\166\145\x6c", "\x74\x79\x70\x65"))->where(array("\x6c\x65\166\x65\x6c", "\x4c\111\x4b\x45", "\45\x2c{$id}\54\45"))->all(); goto yDPX2; gr6xc: goto ybT1Z; goto ZjFer; klrGS: BoXPY: goto mDPdd; FctAu: $this->db->rollBack(); goto CKwd0; GTa_j: $this->db->commit(); goto zwBI1; Hn1Ev: ybT1Z: goto xqmpF; bDk91: g_vAE: goto GTa_j; FpRz8: if ($this->db->update($this->table, array("\x6e\141\x6d\x65" => $name), array("\x69\x64", "\75", $id))->is()) { goto J2Mzn; } goto wjbLn; ljhVx: if ($this->db->update($this->table, array("\156\141\155\x65" => $name), array("\x69\144", "\x3d", $id))->is()) { goto BoXPY; } goto XJhh8; vAr5p: } protected function postIsFile($request_data) { goto ijTS7; Ex4cP: if (file_exists($this->_UTF82GBK("\56\56\x2f" . $path . $name))) { goto o2yJC; } goto sl5Hb; ijTS7: $path = $request_data["\x70\x61\164\x68"]; goto Gvf1J; DuI2c: SqKAo: goto AMqsm; sl5Hb: return $this->error($name . "\x20\346\x96\x87\xe4\xbb\xb6\344\xb8\x8d\xe5\xad\230\xe5\x9c\xa8\357\xbc\201"); goto g737H; WpNOM: o2yJC: goto F1Wgp; F1Wgp: return $this->success($name . "\x20\xe6\x96\207\xe4\273\266\xe5\267\xb2\345\255\230\345\x9c\xa8\xef\274\201"); goto DuI2c; Gvf1J: $name = $request_data["\156\x61\155\145"]; goto Ex4cP; g737H: goto SqKAo; goto WpNOM; AMqsm: } protected function postDelete($request_data) { goto fmrQZ; QoB0u: nOqJV: goto n8c0S; fmrQZ: $ids = $request_data["\151\144"]; goto mfv_k; n8c0S: return $this->success(); goto CWJfj; mfv_k: foreach ($ids as $id) { goto UdV1U; F61TW: goto nD5Za; goto dB1zx; v9ijt: $this->db->delete($this->table, array("\x6c\x65\x76\x65\x6c", "\114\x49\113\x45", "\x25\54{$id}\54\x25")); goto F61TW; Z6bk5: goto a7l4P; goto n9RjX; RBlQb: if (!$this->db->delete($this->table, array("\151\x64", "\75", $id))->is()) { goto h9jAD; } goto guQ_F; J8i7D: goto a7l4P; goto FX0ai; d0Raz: a7l4P: goto MUPAN; UdV1U: $file = $this->db->select($this->table, array("\160\x61\164\150", "\156\141\x6d\x65"))->where(array("\151\x64", "\75", $id))->get(); goto F8zdO; EvLmr: $this->_rmdir($filename); goto VtKjB; eL3rC: if (is_dir($filename)) { goto nfkVY; } goto v9ijt; n9RjX: GB1D3: goto GkRXs; guQ_F: @unlink($filename); goto JKFMr; FX0ai: yTYbj: goto sdusw; VtKjB: CPZwS: goto uQ5hs; F8zdO: if ($file) { goto yTYbj; } goto J8i7D; uQ5hs: nD5Za: goto d0Raz; bxEQQ: goto nD5Za; goto mdABn; aCBxY: if (!(!$path || stripos($path, "\x64\141\x74\141\57\146\151\x6e\x64\145\162\x2f") === false || $name == null || $name == '')) { goto GB1D3; } goto QOvvq; mTpU5: if (is_file($filename)) { goto d_mZ1; } goto eL3rC; sdusw: $path = $file["\160\141\164\150"]; goto WsyK_; PGrIn: if (!$this->db->delete($this->table, array("\154\145\x76\x65\154", "\114\111\113\x45", "\x25\54{$id}\x2c\45"))->is()) { goto CPZwS; } goto EvLmr; WsyK_: $name = $file["\x6e\x61\x6d\145"]; goto aCBxY; JKFMr: h9jAD: goto bxEQQ; mdABn: nfkVY: goto PGrIn; QOvvq: $this->db->delete($this->table, array("\151\144", "\75", $id))->is(); goto Z6bk5; dB1zx: d_mZ1: goto RBlQb; GkRXs: $filename = $this->_UTF82GBK("\56\56\x2f" . $path . $name); goto mTpU5; MUPAN: } goto QoB0u; CWJfj: } protected function getCurPath($foid) { goto A2ELI; A2ELI: $level = $this->db->select($this->table, "\154\x65\166\x65\154")->where(array("\x69\x64", "\x3d", $foid))->get(0); goto VWzZC; ZfHxV: $data = $this->db->select($this->table, array("\x69\x64", "\156\141\155\145"))->where(array(array("\151\x64", "\111\116", $level), "\x41\116\x44", array("\164\x79\x70\x65", "\x3d", "\x66\157\x6c\x64\145\x72")))->all(); goto MWeo2; VWzZC: $level = array_filter(explode("\54", $level)); goto ZfHxV; MWeo2: return $this->success('', $data); goto U9BGM; U9BGM: } }
